FROM node:18-alpine as meta

WORKDIR /app

COPY . /app

# creates same folder structure as project with only package.json files
RUN npm run deps-meta

FROM node:18-alpine as build

WORKDIR /app

COPY --from=meta /app/.deps/ /app

RUN npm install

RUN bundle -- -w service-b

FROM node:18-alpine

WORKDIR /app

COPY --from=build /app/packages/services/service-b/dist/ /app/dist

CMD [ "node", "--enable-source-maps", "/app/dist/server.js"]
